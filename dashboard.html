<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard — Intent FreeDomain</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<script>const API_BASE='https://backend-render-gehg.onrender.com'; function api(p){return API_BASE+p}</script>

<style>
:root{
  --bg:#071226; --panel:rgba(255,255,255,0.02); --muted:#94a3b8; --accent:#06b6d4; --accent2:#3b82f6; --text:#e6eef6;
  --card-radius:14px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg),#071a2a);color:var(--muted)}
header{position:sticky;top:0;display:flex;justify-content:space-between;padding:14px 20px;border-bottom:1px solid rgba(255,255,255,0.03)}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2))}
.container{max-width:1150px;margin:28px auto;padding:0 18px 80px}
.grid{display:grid;grid-template-columns:1fr 380px;gap:18px}
.card{background:linear-gradient(180deg,var(--panel),rgba(255,255,255,0.01));padding:22px;border-radius:14px}
.h1{color:var(--text);font-size:24px}
.small{font-size:14px}
.input{width:100%;padding:12px;border-radius:10px;background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.05)}
.btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
.btn-primary{background:linear-gradient(180deg,var(--accent),var(--accent2));color:#022}
.btn-ghost{background:red;color:#fff}
.subtable{width:100%;border-collapse:collapse}
.subtable th,.subtable td{padding:10px;border-top:1px solid rgba(255,255,255,0.03)}
.tag{padding:6px 8px;border-radius:999px;background:rgba(6,182,212,0.1)}
.modal{position:fixed;inset:0;background:black;display:none;align-items:center;justify-content:center}
.modal-card{background:#000;padding:18px;border-radius:12px;width:720px}
.ns-list{display:flex;flex-direction:column;gap:8px}
.ns-item{display:flex;gap:8px}
.ns-input{flex:1;padding:10px;border-radius:8px;background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.05)}
.ns-btn{padding:8px;border-radius:8px;background:#222;color:#fff}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo"></div>
    <div>
      <div style="font-weight:800;color:#fff">Intent Dashboard</div>
      <div class="small">NS-only subdomain manager</div>
    </div>
  </div>
  <button id="logoutBtn" class="btn btn-ghost">Logout</button>
</header>

<main class="container">
  <div class="grid">
    <div>
      <section class="card">
        <div class="h1">Account</div>
        <div id="accountBlock" class="small">Loading...</div>
      </section>

      <section class="card" style="margin-top:18px">
        <div class="h1">Subdomains</div>
        <table class="subtable">
          <thead>
            <tr><th>Name</th><th>NS</th><th>Status</th><th>Actions</th></tr>
          </thead>
          <tbody id="subBody"></tbody>
        </table>
      </section>
    </div>
  </div>
</main>

<div id="editModal" class="modal">
  <div class="modal-card">
    <div class="h1" id="editTitle"></div>

    <input id="edit_targets" class="input" placeholder="Targets (optional)">

    <div id="edit_ns_list" class="ns-list"></div>
    <button id="edit_add_ns_btn" class="ns-btn">+ Add NS</button>

    <div style="margin-top:12px">
      <button id="saveEdit" class="btn btn-primary">Save</button>
      <button id="closeModal" class="btn btn-ghost">Close</button>
    </div>
  </div>
</div>

<script>
const API = api('');
const token = localStorage.getItem('intent_token');

function createNsInput(v=''){
  const d=document.createElement('div');d.className='ns-item';
  const i=document.createElement('input');i.className='ns-input';i.value=v;
  const b=document.createElement('button');b.className='ns-btn';b.textContent='−';
  b.onclick=()=>d.remove();
  d.append(i,b);return d;
}

function setNsList(id,arr){
  const c=document.getElementById(id);c.innerHTML='';
  (arr.length?arr:['']).forEach(v=>c.appendChild(createNsInput(v)));
}

function renderSubs(list){
  const b=document.getElementById('subBody');b.innerHTML='';
  list.forEach(sd=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${sd.name}</td>
      <td>${Array.isArray(sd.ns)?sd.ns.join(', '):(sd.ns||'-')}</td>
      <td><span class="tag">${sd.status}</span></td>
      <td><button class="btn btn-ghost">Edit</button></td>`;
    tr.querySelector('button').onclick=()=>openEdit(sd);
    b.appendChild(tr);
  });
}

function openEdit(sd){
  document.getElementById('editTitle').textContent='Edit '+sd.name;
  document.getElementById('edit_targets').value=sd.target||'';

  let ns=[];
  if(Array.isArray(sd.ns)) ns=sd.ns;
  else if(typeof sd.ns==='string') ns=sd.ns.split('|').filter(Boolean);

  ns=ns.map(n=>n.endsWith('.')?n.slice(0,-1):n);
  setNsList('edit_ns_list',ns);

  document.getElementById('editModal').style.display='flex';
}

document.getElementById('edit_add_ns_btn').onclick=()=>{
  document.getElementById('edit_ns_list').appendChild(createNsInput());
};
document.getElementById('closeModal').onclick=()=>{
  document.getElementById('editModal').style.display='none';
};

(async()=>{
  const r=await fetch(API+'/api/subdomains',{headers:{Authorization:'Bearer '+token}});
  const d=await r.json();
  renderSubs(d);
})();
</script>
</body>
</html>
